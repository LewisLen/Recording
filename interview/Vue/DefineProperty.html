<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue2.X响应式原理</title>
<body>
    <div id="app">
    </div>
    <script type="text/javascript">
		let person = {
			a:{
				b:{
					c:{
						name: 'len'
					}
				}
			},
			d:{
				age: '00'
			}
		}
		// 相当于在最外层加个中间的变量val，和getter/setter形成一个闭包
		function defineReactive(target,key,val){
			console.log('defineReactive',defineReactive);
			if(arguments.length === 2){
				// 如果没有传初始值，则读取赋值所传的key/value值
				val = target[key]
			}
			Object.defineProperty(target,key,{
				enumerable: true,
				configurable: true,
				get(){
					// 当读取name属性时调用
					console.log('getter====')
					return temp
				},
				set(newValue){
					// 当设置name属性时调用
					console.log('setter====',newValue)
					if(val === newValue) return;
					temp = newValue
				}
			})
		}

		const def = (obj,key,value,enumerable) => {
			console.log('def====obj',obj)
			console.log('def====key',key)
			console.log('def====value',value)
			Object.defineProperty(obj,key,{
				value,
				enumerable,
				writable: true,
				configurable: true
			})
		}

		// 实现对象（各个层级）属性被侦测（即被观察）
		class Observer{
			constructor(obj){
				console.log('Observer观察者类obj',obj)
				// 给实例加上defineProperty，可枚举
				def(obj,obj.__ob__,this,false)
			}
			// 遍历每个对象的层级属性
			walk(obj){
				for(let k in obj){
					defineReactive(obj,key)
				}
			}
	}

		// 
		function observe(obj){
			console.log('observe====',obj)
			if(typeof obj !== 'object') return;
			// ob存储Observer的实例
			// __ob_是Observer的属性
			var ob;
			if(typeof obj.__ob__ !== 'undefined'){
				ob = obj.__ob__;
			}else{
				ob = new Observer(obj);
			}
			return ob;
		}

		observe(person)
		/*
			let data = {
				msg: 'Hello',
				name: 'Len'
			}
			
			// 模拟vue的实例
			let vm = {}
			// Object.keys循环对象属性
			Object.keys(data).forEach(key => {
				// 数据劫持：当访问或者设置vm中的数据时做的一些操作
				Object.defineProperty(vm,key,{
					get(){
						console.log('getter')
						document.querySelector("#app").textContent = data[key];
						return data[key]
					},
					set(newVal){
						console.log('setter');
						data[key] = newVal;
						document.querySelector("#app").textContent = data[key];
						return;
					}
				})
			})
			console.log(vm.msg)
			*/

			/*
			let _data = {
				msg: 'Hello',
				name: 'Len'
			}
			
			const _vm = new Proxy(_data,{
				get(target,key){
					console.log('gettter',' key==',key,' taget[key===]',target[key])
					return target[key]
				},
				set(target,key,newValue){
					console.log('settter',' key==',key,' taget[key===]',target[key],' newValue===',newValue)
					if(target[key] === newValue){
						return;
					}
					target[key] = newValue;
					document.querySelector('#root').textContent = target[key];
				}
			})
			*/
    </script>
</body>
</html>